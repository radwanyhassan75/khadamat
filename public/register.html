<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>إنشاء حساب جديد - المكتب الرقمي</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    
    <!-- Google API for reCAPTCHA and One Tap -->
    <script src="https://www.google.com/recaptcha/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        :root {
            --primary-color: #0056b3;
            --primary-hover-color: #004494;
            --secondary-color: #f0f6ff;
            --dark-color: #1d2d3d;
            --light-color: #ffffff;
            --gray-color: #f7f9fc;
            --text-color: #555;
            --text-light: #a9b4c2;
            --border-color: #e0e0e0;
            --border-radius: 12px;
            --box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            --success-color: #198754;
            --danger-color: #dc3545;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            background-color: var(--gray-color);
            direction: rtl;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        .main-header {
            background: var(--light-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 10px 5%;
            width: 100%;
            box-sizing: border-box;
            z-index: 100;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        .navbar-logo img { height: 60px; }
        .nav-links {
            list-style: none;
            display: flex;
            gap: 25px;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 600;
            font-size: 1rem;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--primary-color); }
        .hamburger { display: none; cursor: pointer; }
        .hamburger .bar {
            display: block;
            width: 25px;
            height: 3px;
            margin: 5px auto;
            background-color: var(--dark-color);
            transition: all 0.3s ease-in-out;
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .main-container {
            display: flex;
            width: 100%;
            max-width: 1100px;
            background: var(--light-color);
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .form-section {
            flex: 1;
            padding: 40px 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
        }
        
        .branding-section {
            flex: 1;
            background: linear-gradient(135deg, var(--primary-color), #003a75), url('https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxfDB8MXxyYW5kb218MHx8b2ZmaWNlLGNvbXB1dGVyc3x8fHx8fDE3MjE3MzQ0MzA&ixlib=rb-4.0.3&q=80&utm_campaign=api-credit&utm_medium=referral&utm_source=unsplash_source&w=1080') no-repeat center center;
            background-size: cover;
            background-blend-mode: multiply;
            color: var(--light-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px;
        }

        .branding-section .logo {
            height: 100px;
            margin-bottom: 20px;
            filter: brightness(0) invert(1);
        }
        
        .branding-section h1 { font-size: 2.5rem; font-weight: 900; margin-bottom: 15px; }
        .branding-section p { font-size: 1.1rem; max-width: 350px; line-height: 1.7; }
        .form-header .logo-mobile { display: none; height: 70px; margin-bottom: 15px; }
        .form-header h1 { font-size: 2rem; font-weight: 900; color: var(--dark-color); margin: 0 0 5px 0; text-align: center; }
        .form-header p { font-size: 1rem; color: var(--text-color); margin-bottom: 25px; text-align: center; }

        .form-group { margin-bottom: 18px; text-align: right; position: relative; }
        .form-group label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.9rem; }
        .form-group input {
            width: 100%; padding: 14px 16px; border: 1px solid var(--border-color);
            border-radius: var(--border-radius); font-size: 1rem; box-sizing: border-box;
            transition: all 0.3s ease; background-color: var(--gray-color);
        }
        .form-group input:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2); background-color: var(--light-color);
        }

        .btn {
            width: 100%; padding: 15px; font-size: 1.1rem; background-color: var(--primary-color);
            border: none; color: white; font-weight: bold; border-radius: var(--border-radius);
            cursor: pointer; transition: background-color 0.3s, transform 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:hover:not(:disabled) { background-color: var(--primary-hover-color); transform: translateY(-2px); }
        .btn:disabled { background-color: #a5b4fc; cursor: not-allowed; }

        .social-login { display: flex; gap: 15px; margin: 20px 0; }
        .btn-social { flex: 1; background: var(--light-color); color: var(--dark-color); border: 1px solid var(--border-color); }
        .btn-social i { font-size: 1.2rem; }
        .btn-google i { color: #ea4335; }
        .btn-facebook i { color: #1877f2; }

        .divider { display: flex; align-items: center; text-align: center; color: #aaa; margin: 20px 0; font-size: 0.9rem; }
        .divider::before, .divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--border-color); }
        .divider:not(:empty)::before { margin-left: .5em; }
        .divider:not(:empty)::after { margin-right: .5em; }

        .form-footer { margin-top: 20px; font-size: 0.95rem; text-align: center; }
        .form-footer a { color: var(--primary-color); text-decoration: none; font-weight: 700; }

        #message-box { display: none; padding: 15px; margin-bottom: 20px; border-radius: var(--border-radius); font-weight: 600; text-align: center; }
        #message-box.success { background-color: #e9f7ef; color: #28a745; border: 1px solid #a3e9a4; }
        #message-box.error { background-color: #fdecea; color: #dc3545; border: 1px solid #f5c6cb;}

        .terms-group { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .terms-group input[type='checkbox'] { width: auto; }
        .terms-group label { margin-bottom: 0; }

        #recaptcha-container { min-height: 78px; margin-bottom: 15px; display: flex; justify-content: center; transform: scale(0.95); transform-origin: center; }
        
        /* --- Footer --- */
        .main-footer {
            padding: 50px 5%;
            background: var(--dark-color);
            color: var(--text-light);
        }
        .footer-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 40px;
            border-bottom: 1px solid #3a4a5b;
        }
        .footer-col h3 { color: var(--light-color); font-size: 1.2rem; margin-bottom: 20px; }
        .footer-col p { line-height: 1.8; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col ul li { margin-bottom: 10px; }
        .footer-col ul a { text-decoration: none; color: var(--text-light); transition: color 0.3s; }
        .footer-col ul a:hover { color: var(--light-color); }
        .footer-bottom { text-align: center; padding-top: 30px; font-size: 0.9rem; }
        .footer-bottom a { color: var(--light-color); text-decoration: none; }
        
        /* --- Responsive Design --- */
        @media (max-width: 992px) {
            .nav-links {
                position: fixed; top: 80px; right: -100%;
                background: var(--light-color); width: 100%;
                height: calc(100vh - 80px); flex-direction: column;
                align-items: center; padding-top: 50px;
                transition: right 0.5s ease-in-out;
            }
            .nav-links.active { right: 0; }
            .hamburger { display: block; }
            .hamburger.active .bar:nth-child(2) { opacity: 0; }
            .hamburger.active .bar:nth-child(1) { transform: translateY(8px) rotate(45deg); }
            .hamburger.active .bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
            
            .branding-section { display: none; }
            .form-header .logo-mobile { display: block; margin-right: auto; margin-left: auto; }
            .form-section { padding: 30px; }
            .main-container { width: 100%; max-width: 500px; }
        }
        
        @media (max-width: 576px) {
             .main-content { padding: 20px 10px; }
             .form-section { padding: 20px; }
             .social-login { flex-direction: column; }
             .main-container { box-shadow: none; border-radius: 0; }
        }

    </style>
</head>
<body>
    <header class="main-header">
        <nav class="navbar">
            <a href="index.html" class="navbar-logo">
                <img src="https://github.com/radwanyhassan75/logo.png/blob/main/20832c91-c5a0-4bb1-a95f-b8c8bd097d7a-removebg-preview.png?raw=true" alt="شعار المكتب الرقمي">
            </a>
            <ul class="nav-links">
                <li><a href="index.html">الرئيسية</a></li>
                <li><a href="services.html">الخدمات</a></li>
                <li><a href="about.html">من نحن</a></li>
                <li><a href="contact.html">اتصل بنا</a></li>
                <li><a href="tracking.html">تتبع الطلب</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="main-container">
            <div class="branding-section">
                <img src="https://github.com/radwanyhassan75/logo.png/blob/main/20832c91-c5a0-4bb1-a95f-b8c8bd097d7a-removebg-preview.png?raw=true" alt="شعار المكتب الرقمي" class="logo">
                <h1>مرحباً بك في المستقبل الرقمي</h1>
                <p>انضم إلى منصتنا لإدارة خدماتك بكفاءة وسهولة لا مثيل لها.</p>
            </div>
            
            <div class="form-section">
                <header class="form-header">
                    <img src="https://github.com/radwanyhassan75/logo.png/blob/main/20832c91-c5a0-4bb1-a95f-b8c8bd097d7a-removebg-preview.png?raw=true" alt="شعار المكتب الرقمي" class="logo-mobile">
                    <h1>إنشاء حساب جديد</h1>
                    <p>انضم إلينا وابدأ في إنجاز خدماتك بسهولة.</p>
                </header>

                <div class="social-login">
                    <button id="google-signup" class="btn btn-social btn-google"><i class="fab fa-google"></i> التسجيل بحساب Google</button>
                    <button id="facebook-signup" class="btn btn-social btn-facebook"><i class="fab fa-facebook-f"></i> التسجيل بحساب Facebook</button>
                </div>

                <div class="divider">أو</div>
                
                <div id="message-box"></div>
                
                <form id="register-form">
                    <div class="form-group">
                        <label for="name">الاسم الكامل</label>
                        <input type="text" id="name" required />
                    </div>
                    <div class="form-group">
                        <label for="email">البريد الإلكتروني</label>
                        <input type="email" id="email" required />
                    </div>
                    <div class="form-group">
                        <label for="password">كلمة المرور</label>
                        <input type="password" id="password" required />
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">تأكيد كلمة المرور</label>
                        <input type="password" id="confirm-password" required />
                    </div>
                    <div class="form-group terms-group">
                        <input type="checkbox" id="terms" required />
                        <label for="terms">أوافق على <a href="terms.html" target="_blank">شروط الاستخدام</a> و <a href="privacy.html" target="_blank">سياسة الخصوصية</a>.</label>
                    </div>
                    <div id="recaptcha-container"></div>
                    <button type="submit" id="submit-btn" class="btn" disabled>
                        <i class="fas fa-lock"></i> الرجاء التحقق من reCAPTCHA
                    </button>
                </form>
                
                <div class="form-footer">
                    <p>لديك حساب بالفعل؟ <a href="login.html">سجل الدخول</a></p>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-col">
                <h3>المكتب الرقمي</h3>
                <p>منصة متكاملة لتسهيل جميع معاملاتك الإدارية والرقمية بكفاءة وموثوقية عالية.</p>
            </div>
            <div class="footer-col">
                <h3>روابط سريعة</h3>
                <ul>
                    <li><a href="about.html">من نحن</a></li>
                    <li><a href="services.html">الخدمات</a></li>
                    <li><a href="contact.html">اتصل بنا</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>قانوني</h3>
                <ul>
                    <li><a href="privacy.html">سياسة الخصوصية</a></li>
                    <li><a href="terms.html">الشروط والاحكام</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 المكتب الرقمي. جميع الحقوق محفوظة.</p>
            <p>تم تصميم الموقع بواسطة <a href="#">HASSAN</a></p>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <!-- Your Firebase configuration -->
    <script src="auth.js"></script> 
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Mobile Menu ---
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });

            // --- The rest of the script is the same ---
            const registerForm = document.getElementById('register-form');
            const submitBtn = document.getElementById('submit-btn');
            const messageBox = document.getElementById('message-box');

            function initRecaptcha() {
                if(document.getElementById('recaptcha-container').innerHTML !== '') return;
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                    'size': 'normal',
                    'callback': (response) => {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> إنشاء الحساب';
                    },
                    'expired-callback': () => {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-lock"></i> الرجاء التحقق من reCAPTCHA';
                    }
                });
                recaptchaVerifier.render().catch(error => {
                    console.error("reCAPTCHA render error:", error);
                    showMessage("لا يمكن عرض reCAPTCHA. يرجى تحديث الصفحة.", "error");
                });
            }
            setTimeout(initRecaptcha, 500);

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById("name").value.trim();
                const email = document.getElementById("email").value.trim();
                const password = document.getElementById("password").value;
                const confirmPassword = document.getElementById("confirm-password").value;
                const termsChecked = document.getElementById("terms").checked;

                if (password.length < 6) { showMessage("يجب أن تتكون كلمة المرور من 6 أحرف على الأقل.", "error"); return; }
                if (password !== confirmPassword) { showMessage("خطأ: كلمتا المرور غير متطابقتين.", "error"); return; }
                if (!termsChecked) { showMessage("الرجاء الموافقة على شروط الاستخدام.", "error"); return; }
                
                setLoading(true);

                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        return user.updateProfile({ displayName: name }).then(() => user);
                    })
                    .then((user) => {
                        console.log("User created, syncing with backend...");
                        // syncUserWithBackend(user); 
                        return user.sendEmailVerification();
                    })
                    .then(() => { window.location.href = "verify-email.html"; })
                    .catch((error) => { handleAuthError(error); });
            });

            document.getElementById("google-signup").addEventListener("click", () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider)
                    .then((result) => handleSocialLogin(result))
                    .catch(handleAuthError);
            });
            
            document.getElementById("facebook-signup").addEventListener("click", () => {
                const provider = new firebase.auth.FacebookAuthProvider();
                 auth.signInWithPopup(provider)
                    .then((result) => handleSocialLogin(result))
                    .catch(handleAuthError);
            });
            
            // --- Google One Tap Sign-In ---
            window.onGoogleLibraryLoad = () => {
                google.accounts.id.initialize({
                    // ⚠️ هام جداً: استبدل هذا المعرف بمعرف العميل الحقيقي الخاص بك من Google Cloud Console
                    client_id: '690661888019-2k8fl4c839q0mnki373ii96nhhb4ckmh.apps.googleusercontent.com',
                    callback: handleGoogleOneTap,
                    auto_select: true,
                    prompt_parent_id: 'g_id_onload'
                });
                google.accounts.id.prompt(); 
            };
            
            function handleGoogleOneTap(response) {
                console.log("Received One-Tap response:", response);
                const id_token = response.credential;
                const credential = firebase.auth.GoogleAuthProvider.credential(id_token);
                
                auth.signInWithCredential(credential)
                    .then((result) => handleSocialLogin(result))
                    .catch(error => {
                        console.error("Firebase signInWithCredential error:", error);
                        handleAuthError(error, "حدث خطأ أثناء محاولة ربط حسابك في Google.");
                    });
            }
            
            function handleSocialLogin(result) {
                const user = result.user;
                const isNewUser = result.additionalUserInfo.isNewUser;
                if (isNewUser) {
                    console.log("New social user, syncing with backend...");
                    // syncUserWithBackend(user); 
                }
                window.location.href = "dashboard.html";
            }

            function showMessage(message, type) {
                messageBox.textContent = message;
                messageBox.className = ``;
                messageBox.classList.add(type);
                messageBox.style.display = "block";
            }
            
            function setLoading(isLoading) {
                if (isLoading) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جارٍ الإنشاء...';
                    messageBox.style.display = "none";
                } else {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> إنشاء الحساب';
                }
            }
            
            function handleAuthError(error, customMessage) {
                console.error("Authentication Error:", error);
                let friendlyMessage = customMessage || "حدث خطأ غير متوقع. الرجاء المحاولة مرة أخرى.";
                if (!customMessage) {
                    switch (error.code) {
                        case 'auth/email-already-in-use': friendlyMessage = "هذا البريد الإلكتروني مسجل بالفعل. حاول تسجيل الدخول."; break;
                        case 'auth/invalid-email': friendlyMessage = "البريد الإلكتروني الذي أدخلته غير صالح."; break;
                        case 'auth/weak-password': friendlyMessage = "كلمة المرور ضعيفة جدًا. يرجى اختيار كلمة مرور أقوى."; break;
                        case 'auth/popup-closed-by-user': friendlyMessage = "تم إلغاء نافذة التسجيل. يرجى المحاولة مرة أخرى."; break;
                        case 'auth/account-exists-with-different-credential': friendlyMessage = "لديك حساب مسجل بالفعل باستخدام طريقة أخرى بنفس البريد الإلكتروني."; break;
                    }
                }
                showMessage(friendlyMessage, "error");
                setLoading(false);
                if (window.recaptchaVerifier && typeof grecaptcha !== 'undefined') {
                    grecaptcha.reset();
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-lock"></i> الرجاء التحقق من reCAPTCHA';
                }
            }
        });
    </script>
</body>
</html>