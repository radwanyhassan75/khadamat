<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link href="output.css" rel="stylesheet">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1245242841843828"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خدماتنا الكاملة - المكتب الرقمي</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --primary-color: #0056b3; --secondary-color: #0d6efd; --dark-color: #2c3e50;
            --light-color: #ffffff; --gray-color: #f8f9fa; --text-color: #555;
            --border-radius: 12px; --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.07);
            --success-color: #198754; --warning-color: #ffc107;
        }
        body { font-family: 'Cairo', sans-serif; margin: 0; background-color: var(--gray-color); direction: rtl; }
        .main-header { background: var(--light-color); box-shadow: 0 2px 10px rgba(0,0,0,0.08); position: sticky; top: 0; width: 100%; z-index: 1000; }
        .navbar { display: flex; justify-content: space-between; align-items: center; height: 80px; padding: 0 5%; max-width: 1200px; margin: 0 auto; }
        .navbar-logo img { height: 70px; }
        .navbar-menu { display: none; list-style: none; gap: 35px; margin: 0; padding: 0; align-items: center; }
        .navbar-menu a { text-decoration: none; color: var(--dark-color); font-weight: 700; font-size: 1.1rem; padding-bottom: 5px; border-bottom: 3px solid transparent; transition: all 0.3s ease; }
        .navbar-menu a:hover, .navbar-menu a.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .navbar-actions { position: relative; }
        .hamburger-menu { display: block; font-size: 1.8rem; cursor: pointer; color: var(--dark-color); }
        .page-header { background: linear-gradient(135deg, var(--dark-color) 0%, var(--primary-color) 100%); text-align: center; padding: 70px 20px; color: var(--light-color); }
        .page-header h1 { font-size: 3.5rem; font-weight: 900; margin-bottom: 10px; text-shadow: 2px 2px 5px rgba(0,0,0,0.2); }
        .page-header p { font-size: 1.3rem; color: #dce1e4; max-width: 700px; margin: 0 auto; }
        .accordion-container { max-width: 900px; margin: 60px auto; padding: 0 20px; }
        .accordion-item { margin-bottom: 15px; background: var(--light-color); box-shadow: var(--box-shadow); border-radius: var(--border-radius); overflow: hidden; border: 1px solid #e9ecef; transition: box-shadow 0.3s ease; }
        .accordion-header { background: transparent; border: none; width: 100%; padding: 20px 25px; text-align: right; font-size: 1.5rem; font-weight: 800; color: var(--dark-color); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.3s ease; font-family: 'Cairo', sans-serif; }
        .accordion-header i:first-of-type { color: var(--primary-color); margin-left: 15px; font-size: 1.8rem; }
        .accordion-header h3 { margin: 0; font-size: 1.5rem; font-weight: 800; }
        .accordion-header .fa-chevron-down { transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1); }
        .accordion-header.active .fa-chevron-down { transform: rotate(180deg); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s cubic-bezier(0.22, 1, 0.36, 1); }
        .service-entry { display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; border-top: 1px solid #eee; }
        .service-info h4 { margin: 0 0 5px 0; font-size: 1.2rem; color: var(--dark-color); font-weight: 700; }
        .service-info p { margin: 0; font-size: 0.95rem; color: var(--text-color); line-height: 1.6; }
        .service-price-action { display: flex; align-items: center; gap: 20px; flex-shrink: 0; }
        .price { font-size: 1.2rem; font-weight: 800; color: var(--dark-color); white-space: nowrap; }
        .btn-order { background: var(--primary-color); color: white; border: none; padding: 10px 25px; border-radius: 50px; font-weight: 700; cursor: pointer; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn-order:hover { background-color: var(--success-color); transform: translateY(-2px) scale(1.05); }
        
        /* --- NEW: Star Rating Display --- */
        .rating-display { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .rating-display .stars { color: var(--warning-color); font-size: 1rem; }
        .rating-display .stars .fa-star.empty { color: #e0e0e0; }
        .rating-display .rating-text { font-size: 0.9rem; color: #6c757d; font-weight: 600; }

        @media (max-width: 992px) { .navbar-menu { display: none; } .hamburger-menu { display: block; } .navbar-menu.mobile-active { display: flex; flex-direction: column; position: fixed; top: 80px; right: 0; background-color: var(--light-color); width: 100%; padding: 20px 0; box-shadow: var(--box-shadow); text-align: center; gap: 20px; } }
        @media (max-width: 768px) { .page-header h1 { font-size: 2.8rem; } .page-header p { font-size: 1.1rem; } .service-entry { flex-direction: column; align-items: flex-start; gap: 15px; } .service-price-action { width: 100%; justify-content: space-between; } }
        @media (min-width: 993px) { .hamburger-menu { display: none; } .navbar-menu { display: flex; } }
    </style>
</head>
<body>

    <header class="main-header">
        <nav class="navbar">
            <a href="index.html" class="navbar-logo">
                <img src="https://github.com/radwanyhassan75/logo.png/blob/main/20832c91-c5a0-4bb1-a95f-b8c8bd097d7a-removebg-preview.png?raw=true" alt="شعار المكتب الرقمي">
            </a>
            <ul class="navbar-menu">
                <li><a href="index.html">الرئيسية</a></li>
                <li><a href="services.html" class="active">الخدمات</a></li>
                <li><a href="contact.html">اتصل بنا</a></li>
                <div id="mobile-navbar-actions"></div>
            </ul>
            <div id="navbar-actions" class="navbar-actions"></div>
            <div class="hamburger-menu"><i class="fas fa-bars"></i></div>
        </nav>
    </header>

    <main>
        <section class="page-header">
            <h1>قائمة خدماتنا الكاملة</h1>
            <p>نقدم لكم باقة متكاملة من الخدمات الرقمية والإدارية لتسهيل معاملاتكم اليومية. تصفح الأقسام واختر ما يناسب احتياجاتك بسهولة.</p>
        </section>

        <div id="accordion-container" class="accordion-container">
            <p id="loading-state" style="text-align: center; font-size: 1.2rem; color: #555; padding: 50px;">جاري تحميل الخدمات...</p>
        </div>
    </main>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="auth.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const WORKER_URL = 'https://orders-worker.radwanyhassan75.workers.dev';
            const accordionContainer = document.getElementById('accordion-container');
            const loadingState = document.getElementById('loading-state');
            
            const categoryIcons = {
                'خدمات إدارية': 'fa-file-signature',
                'خدمات التعليم والتكوين': 'fa-user-graduate',
                'خدمات التوظيف والمباريات': 'fa-briefcase',
                'خدمات اجتماعية وصحية': 'fa-heartbeat',
                'خدمات رقمية وتقنية': 'fa-laptop-code',
                'default': 'fa-concierge-bell'
            };

            function generateSchema(service) {
                if (!service.aggregateRating) return;

                const schema = {
                    "@context": "https://schema.org/",
                    "@type": "Service",
                    "name": service.title,
                    "description": service.description,
                    "provider": {
                        "@type": "Organization",
                        "name": "المكتب الرقمي"
                    },
                    "aggregateRating": {
                        "@type": "AggregateRating",
                        "ratingValue": service.aggregateRating.ratingValue,
                        "reviewCount": service.aggregateRating.reviewCount
                    }
                };

                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.textContent = JSON.stringify(schema);
                document.head.appendChild(script);
            }

            function renderStars(ratingValue, reviewCount) {
                const rating = parseFloat(ratingValue);
                let starsHTML = '';
                for (let i = 1; i <= 5; i++) {
                    starsHTML += `<i class="fas fa-star ${i <= rating ? '' : 'empty'}"></i>`;
                }
                return `
                    <div class="rating-display">
                        <div class="stars">${starsHTML}</div>
                        <span class="rating-text">${rating.toFixed(1)} (${reviewCount} مراجعة)</span>
                    </div>`;
            }

            async function fetchAndRenderServices() {
                try {
                    const response = await fetch(`${WORKER_URL}/api/services`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const services = await response.json();
                    
                    if (services.length === 0) {
                        loadingState.textContent = 'لا توجد خدمات متاحة حاليًا.';
                        return;
                    }

                    const servicesByCategory = services.reduce((acc, service) => {
                        const category = service.category || 'خدمات متنوعة';
                        if (!acc[category]) acc[category] = [];
                        acc[category].push(service);
                        return acc;
                    }, {});

                    loadingState.style.display = 'none';
                    accordionContainer.innerHTML = '';

                    for (const category in servicesByCategory) {
                        const servicesList = servicesByCategory[category];
                        const iconClass = categoryIcons[category] || categoryIcons['default'];

                        const accordionItem = document.createElement('div');
                        accordionItem.className = 'accordion-item';

                        let serviceEntriesHTML = '';
                        servicesList.forEach(service => {
                            generateSchema(service); // Generate schema for Google
                            const ratingHTML = service.aggregateRating ? renderStars(service.aggregateRating.ratingValue, service.aggregateRating.reviewCount) : '';
                            
                            serviceEntriesHTML += `
                                <div class="service-entry" data-price="${service.price}" data-service="${service.title}">
                                    <div class="service-info">
                                        <h4>${service.title}</h4>
                                        ${ratingHTML}
                                        <p>${service.description}</p>
                                    </div>
                                    <div class="service-price-action">
                                        <span class="price">${service.price} درهم</span>
                                        <button class="btn-order">اطلب الآن</button>
                                    </div>
                                </div>`;
                        });

                        accordionItem.innerHTML = `
                            <button class="accordion-header">
                                <i class="fas ${iconClass}"></i>
                                <h3>${category}</h3>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="accordion-content">
                                <div class="service-list">${serviceEntriesHTML}</div>
                            </div>`;
                        
                        accordionContainer.appendChild(accordionItem);
                    }
                    
                    addEventListeners();

                } catch (error) {
                    console.error('Failed to fetch services:', error);
                    loadingState.textContent = 'حدث خطأ أثناء تحميل الخدمات. يرجى المحاولة مرة أخرى.';
                    loadingState.style.color = 'red';
                }
            }

            function addEventListeners() {
                // منطق الأكورديون المحسّن
                const accordionHeaders = document.querySelectorAll('.accordion-header');
                accordionHeaders.forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const isActive = header.classList.contains('active');
                        
                        document.querySelectorAll('.accordion-header.active').forEach(activeHeader => {
                            if (activeHeader !== header) {
                                activeHeader.classList.remove('active');
                                activeHeader.nextElementSibling.style.maxHeight = null;
                            }
                        });

                        if (isActive) {
                            header.classList.remove('active');
                            content.style.maxHeight = null;
                        } else {
                            header.classList.add('active');
                            content.style.maxHeight = content.scrollHeight + "px";
                        }
                    });
                });

                // منطق أزرار "اطلب الآن"
                const orderButtons = document.querySelectorAll('.btn-order');
                orderButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        const serviceEntry = e.target.closest('.service-entry');
                        const serviceName = serviceEntry.getAttribute('data-service');
                        const servicePrice = serviceEntry.getAttribute('data-price');
                        
                        if (serviceName && servicePrice) {
                            const encodedService = encodeURIComponent(serviceName);
                            const encodedPrice = encodeURIComponent(servicePrice);
                            const url = `./payment-gateway.html?service=${encodedService}&price=${encodedPrice}`;
                            window.location.href = url;
                        } else {
                            console.error('Service name or price not found.');
                            alert('حدث خطأ. لا يمكن العثور على معلومات الخدمة.');
                        }
                    });
                });
            }

            fetchAndRenderServices();
        });
    </script>
</body>
</html>
