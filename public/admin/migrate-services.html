<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نقل الخدمات إلى قاعدة البيانات</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Cairo', sans-serif; } </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-2xl bg-white p-8 rounded-xl shadow-lg">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-2">نقل الخدمات إلى قاعدة البيانات</h1>
        <p class="text-center text-gray-600 mb-6">هذه الصفحة تُستخدم لمرة واحدة فقط لإضافة جميع خدماتك القديمة إلى النظام الجديد. اضغط على الزر أدناه لبدء العملية.</p>
        
        <div class="text-center mb-6">
            <button id="migrate-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-all shadow-md disabled:bg-indigo-400 disabled:cursor-not-allowed">
                بدء نقل الخدمات
            </button>
        </div>
        
        <div id="logs" class="bg-gray-800 text-white font-mono text-sm rounded-lg p-4 h-64 overflow-y-auto">
            <p class="text-gray-400">سجل العمليات سيظهر هنا...</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const migrateBtn = document.getElementById('migrate-btn');
            const logsContainer = document.getElementById('logs');
            const WORKER_URL = 'https://orders-worker.radwanyhassan75.workers.dev';

            // القائمة الكاملة للخدمات القديمة
            const servicesToMigrate = [
                // خدمات إدارية
                { category: 'خدمات إدارية', title: 'تحرير الطلبات الخطية', description: 'صياغة احترافية لمختلف الطلبات الموجهة للإدارات العمومية والشركات الخاصة.', price: 20 },
                { category: 'خدمات إدارية', title: 'التصريحات بالشرف', description: 'إعداد وصياغة التصريحات المطلوبة في المعاملات الرسمية، مثل تصريح عدم العمل أو السكن.', price: 15 },
                { category: 'خدمات إدارية', title: 'صياغة عقود والتزامات', description: 'صياغة عقود الكراء، التزامات البيع، أو أي اتفاقات قانونية بسيطة بشكل واضح ودقيق.', price: 15 },
                { category: 'خدمات إدارية', title: 'تصميم سيرة ذاتية (CV)', description: 'تصميم سيرة ذاتية عصرية باللغة العربية أو الفرنسية تناسب متطلبات سوق الشغل.', price: 10 },
                { category: 'خدمات إدارية', title: 'ملء استمارات ومطبوعات', description: 'مساعدتك في ملء أي نوع من الاستمارات الإدارية أو المطبوعات الرسمية بدقة.', price: 10 },
                { category: 'خدمات إدارية', title: 'ترجمة بسيطة للوثائق', description: 'ترجمة غير محلفة للوثائق البسيطة من الفرنسية إلى العربية والعكس.', price: 15 },
                { category: 'خدمات إدارية', title: 'تصحيح الأخطاء اللغوية', description: 'مراجعة وتصحيح النصوص والوثائق لغوياً وإملائياً لضمان خلوها من الأخطاء.', price: 10 },
                { category: 'خدمات إدارية', title: 'إنشاء حسابات إلكترونية', description: 'إنشاء وتأمين حسابات البريد الإلكتروني (Gmail, Outlook) أو حسابات الخدمات الحكومية.', price: 20 },
                { category: 'خدمات إدارية', title: 'تعديل وضغط ملفات PDF', description: 'دمج، تقسيم، أو ضغط حجم ملفات PDF لتسهيل إرسالها أو رفعها.', price: 15 },
                { category: 'خدمات إدارية', title: 'تصفح وتحميل وثائق', description: 'تصفح وتحميل وثائق من مواقع رسمية مختلفة حسب طلبك.', price: 20 },
                { category: 'خدمات إدارية', title: 'صياغة فواتير احترافية', description: 'إعداد فواتير (Factures) للمقاولين الذاتيين والشركات الصغيرة مطابقة للمعايير.', price: 50 },
                { category: 'خدمات إدارية', title: 'صياغة وإرسال الشكايات', description: 'كتابة الشكايات الإدارية وتوجيهها إلى الجهات المعنية عبر المنصات الرسمية.', price: 30 },
                { category: 'خدمات إدارية', title: 'صياغة مراسلات', description: 'صياغة مراسلات احترافية موجهة إلى مختلف الجهات المعنية.', price: 40 },
                { category: 'خدمات إدارية', title: 'خدمات المقاول الذاتي', description: 'المساعدة في الإجراءات المتعلقة بالمقاول الذاتي.', price: 15 },
                // خدمات التعليم والتكوين
                { category: 'خدمات التعليم والتكوين', title: 'التسجيل في "منحتي"', description: 'تقديم طلب الاستفادة من المنحة الجامعية عبر البوابة الوطنية "منحتي".', price: 20 },
                { category: 'خدمات التعليم والتكوين', title: 'التسجيل في التكوين المهني (OFPPT)', description: 'مساعدتك في عملية التسجيل في مختلف معاهد التكوين المهني بالمغرب.', price: 15 },
                { category: 'خدمات التعليم والتكوين', title: 'التسجيل في المدارس العليا', description: 'تقديم طلبات الترشح للمدارس والمعاهد العليا (EST, FST, ENSA, ...).', price: 20 },
                { category: 'خدمات التعليم والتكوين', title: 'التسجيل القبلي في الجامعات', description: 'إتمام عملية التسجيل القبلي في مختلف الجامعات المغربية عبر منصاتها الرقمية.', price: 40 },
                { category: 'خدمات التعليم والتكوين', title: 'طلب الاستفادة من السكن الجامعي', description: 'تقديم طلب الاستفادة من السكن في الأحياء الجامعية عبر المنصة المخصصة.', price: 25 },
                // خدمات التوظيف والمباريات
                { category: 'خدمات التوظيف والمباريات', title: 'تسجيل في مباريات عمومية', description: 'التسجيل في مباريات (الأمن، الوقاية المدنية، الجمارك، التعليم، الصحة...).', price: 80 },
                { category: 'خدمات التوظيف والمباريات', title: 'إعداد ملفات الترشح', description: 'تجهيز وتجميع كل الوثائق المطلوبة (CV، طلب خطي، نسخ، التزام، تصريح...).', price: 80 },
                { category: 'خدمات التوظيف والمباريات', title: 'ملء الطلبات الخاصة بالمباريات', description: 'تعبئة استمارات وملفات التقديم للمباريات المختلفة بدقة واحترافية.', price: 80 },
                { category: 'خدمات التوظيف والمباريات', title: 'تتبع النتائج وطبع اللوائح', description: 'متابعة نتائج المباريات وطباعة لوائح الناجحين والمقبولين.', price: 80 },
                { category: 'خدمات التوظيف والمباريات', title: 'المساعدة في التسجيل في ANAPEC', description: 'إنشاء أو تحديث ملفك الشخصي على بوابة الوكالة الوطنية لإنعاش التشغيل.', price: 80 },
                { category: 'خدمات التوظيف والمباريات', title: 'سيرة ذاتية احترافية (CV)', description: 'تصميم سيرة ذاتية مخصصة وموجهة لفرص العمل والتوظيف.', price: 80 },
                { category: 'خدمات التوظيف والمباريات', title: 'كتابة رسالة تحفيزية (Lettre de motivation)', description: 'صياغة رسالة تحفيزية مخصصة ومقنعة للوظيفة أو التدريب الذي تتقدم إليه.', price: 80 },
                { category: 'خدمات التوظيف والمباريات', title: 'طلبات للموارد البشرية', description: 'صياغة طلبات (شكاية، زيادة راتب، إجازة استثنائية...) للرئيس المباشر أو قسم الموارد البشرية.', price: 80 },
                // خدمات اجتماعية وصحية
                { category: 'خدمات اجتماعية وصحية', title: 'التسجيل في السجل الوطني للسكان (RNP)', description: 'المساعدة في عملية التسجيل للحصول على المعرف الرقمي المدني والاجتماعي.', price: 20 },
                { category: 'خدمات اجتماعية وصحية', title: 'التسجيل في السجل الاجتماعي الموحد (RSU)', description: 'تسجيل الأسرة للاستفادة من برامج الدعم الاجتماعي.', price: 20 },
                { category: 'خدمات اجتماعية وصحية', title: 'تسجيل في الدعم الاجتماعي المباشر', description: 'تقديم طلب الاستفادة من الدعم الاجتماعي المباشر للأسر المؤهلة.', price: 20 },
                { category: 'خدمات اجتماعية وصحية', title: 'المساعدة في إدخال أو تعديل المعطيات', description: 'تحديث أو تصحيح المعلومات الخاصة بالأسرة في السجلات الاجتماعية.', price: 20 },
                { category: 'خدمات اجتماعية وصحية', title: 'استخراج وصل التسجيل أو شهادة', description: 'استخراج الوثائق التي تثبت التسجيل أو الاستفادة من برامج الدعم.', price: 20 },
                { category: 'خدمات اجتماعية وصحية', title: 'استفسار وحل مشاكل CNSS و AMO', description: 'المساعدة في فهم وحل الإشكاليات المتعلقة بالضمان الاجتماعي والتأمين الإجباري عن المرض.', price: 20 },
                // خدمات رقمية وتقنية
                { category: 'خدمات رقمية وتقنية', title: 'إنشاء مواقع إلكترونية بسيطة', description: 'تصميم وبرمجة مواقع تعريفية بسيطة (صفحة واحدة) لعرض معلوماتك أو خدماتك.', price: 200 },
                { category: 'خدمات رقمية وتقنية', title: 'تصميم هوية بصرية', description: 'تصميم شعار (Logo) احترافي وبطاقات عمل (Cartes de visite) تعكس هوية نشاطك.', price: 60 },
                { category: 'خدمات رقمية وتقنية', title: 'تصاميم لمنصات التواصل', description: 'إعداد تصاميم جذابة لمنشوراتك على فيسبوك، انستغرام، وغيرها.', price: 30 },
                { category: 'خدمات رقمية وتقنية', title: 'تعديل الصور والوثائق', description: 'تحسين جودة الصور، إزالة الخلفيات، أو تعديل الوثائق الممسوحة ضوئياً.', price: 15 },
                { category: 'خدمات رقمية وتقنية', title: 'إنشاء رمز الاستجابة السريعة (QR Code)', description: 'إنشاء QR Code مخصص لبطاقة عملك، قائمة طعام، أو رابط موقعك.', price: 10 },
                { category: 'خدمات رقمية وتقنية', title: 'تصميم فواتير Word/Excel', description: 'إنشاء قوالب فواتير قابلة للتعديل على برامج Word أو Excel.', price: 20 },
                { category: 'خدمات رقمية وتقنية', title: 'إدخال البيانات في Excel', description: 'تنظيم وإدخال البيانات في جداول إلكترونية مع إمكانية عمل رسوم بيانية.', price: 30 },
                { category: 'خدمات رقمية وتقنية', title: 'تحويل الملفات (PDF إلى Word...)', description: 'تحويل الملفات بين الصيغ المختلفة مع الحفاظ على التنسيق قدر الإمكان.', price: 15 },
                { category: 'خدمات رقمية وتقنية', title: 'تعبئة استبيانات إلكترونية', description: 'المساعدة في تعبئة الاستبيانات أو الاستمارات الإلكترونية الطويلة والمعقدة.', price: 25 },
            ];

            function log(message, type = 'info') {
                const p = document.createElement('p');
                if (type === 'error') {
                    p.className = 'text-red-400';
                } else if (type === 'success') {
                    p.className = 'text-green-400';
                } else {
                    p.className = 'text-gray-300';
                }
                p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                logsContainer.appendChild(p);
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }

            async function startMigration() {
                migrateBtn.disabled = true;
                migrateBtn.textContent = 'جاري النقل...';
                logsContainer.innerHTML = '';
                log(`بدء عملية النقل... سيتم إضافة ${servicesToMigrate.length} خدمة.`);

                for (const service of servicesToMigrate) {
                    try {
                        const servicePayload = {
                            ...service,
                            status: 'available', // All old services are available by default
                            image_url: '' // No images for old services
                        };

                        const response = await fetch(`${WORKER_URL}/api/admin/services`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(servicePayload)
                        });

                        if (!response.ok) {
                            throw new Error(`Server responded with status ${response.status}`);
                        }
                        
                        await response.json();
                        log(`✅ تم إضافة: ${service.title}`, 'success');

                    } catch (error) {
                        log(`❌ فشل إضافة: ${service.title}. الخطأ: ${error.message}`, 'error');
                    }
                    // Add a small delay to avoid overwhelming the worker
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                log('🎉 اكتملت عملية النقل بنجاح!', 'success');
                migrateBtn.textContent = 'اكتمل النقل';
            }

            migrateBtn.addEventListener('click', startMigration);
        });
    </script>
</body>
</html>
