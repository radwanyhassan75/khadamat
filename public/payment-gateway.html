<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link href="output.css" rel="stylesheet">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1245242841843828"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الطلب - المكتب الرقمي</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!--  Stripe.js Library -->
    <script src="https://js.stripe.com/v3/"></script>

    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #6c757d;
            --stripe-color: #6772e5;
            --dark-color: #2c3e50;
            --light-color: #ffffff;
            --gray-color: #f8f9fa;
            --text-color: #555;
            --border-color: #dee2e6;
            --border-radius: 16px;
            --box-shadow: 0 10px 35px rgba(0, 0, 0, 0.07);
            --success-color: #198754;
            --danger-color: #dc3545;
            --info-color: #eef2ff;
            --info-border-color: #c7d2fe;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Cairo', sans-serif; margin: 0; background-color: var(--gray-color);
            direction: rtl; color: var(--text-color);
        }
        .main-header {
            background: var(--light-color); box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky; top: 0; width: 100%; z-index: 1000;
        }
        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            height: 80px; padding: 0 5%; max-width: 1200px; margin: 0 auto;
        }
        .navbar-logo img { height: 70px; }
        .navbar-menu { display: flex; list-style: none; gap: 35px; margin: 0; padding: 0; align-items: center; }
        .navbar-menu a { text-decoration: none; color: var(--dark-color); font-weight: 700; font-size: 1.1rem; transition: color 0.3s ease; }
        .navbar-menu a:hover { color: var(--primary-color); }
        .page-container { max-width: 800px; margin: 40px auto; padding: 0 20px; }
        .page-header h1 { font-size: 2.8rem; font-weight: 900; color: var(--dark-color); margin: 10px 0; text-align: center; margin-bottom: 40px;}
        .card {
            background: var(--light-color); padding: 30px 40px; border-radius: var(--border-radius);
            box-shadow: var(--box-shadow); margin-bottom: 30px; border: 1px solid #e9ecef;
        }
        .card-header {
            display: flex; align-items: center; gap: 15px; color: var(--dark-color);
            font-size: 1.8rem; font-weight: 900; margin: -30px -40px 25px;
            padding: 20px 40px; border-bottom: 1px solid var(--border-color);
            background-color: var(--gray-color); border-radius: var(--border-radius) var(--border-radius) 0 0;
        }
        .card-header .step-icon {
            background-color: var(--secondary-color); color: white; width: 40px; height: 40px;
            border-radius: 50%; display: inline-flex; align-items: center; justify-content: center;
            font-size: 1.2rem; flex-shrink: 0;
        }
        .form-group { margin-bottom: 20px; }
        label { font-weight: 700; margin-bottom: 8px; display: block; color: var(--dark-color); }
        .required-star { color: var(--danger-color); }
        input, textarea {
            width: 100%; padding: 14px 18px; border: 1px solid #ced4da;
            border-radius: 10px; font-size: 1rem; font-family: 'Cairo', sans-serif;
            box-sizing: border-box; transition: all 0.3s ease;
        }
        input:focus, textarea:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 86, 179, 0.15);
        }
        input[readonly] { background-color: #e9ecef; cursor: not-allowed; }
        .submit-btn {
            width: 100%; padding: 15px; font-size: 1.25rem; border: none;
            color: white; font-weight: bold; border-radius: 10px;
            cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .submit-btn.bank-transfer { background: linear-gradient(45deg, var(--success-color), #20c997); }
        .submit-btn.stripe { background: linear-gradient(45deg, var(--stripe-color), #8591ff); }
        .submit-btn:disabled { background: #adb5bd; cursor: not-allowed; }
        #form-error { display: none; background-color: #f8d7da; color: #842029; padding: 15px; border-radius: var(--border-radius); margin-top: 20px; font-weight: 700; border: 1px solid #f5c2c7; white-space: pre-wrap; text-align: right; line-height: 1.6; }
        
        /* UPDATED: Payment Options Styling */
        .payment-options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .payment-option { 
            border: 2px solid var(--border-color); border-radius: var(--border-radius); padding: 20px;
            cursor: pointer; transition: all 0.3s ease; text-align: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px;
        }
        .payment-option.active { border-color: var(--success-color); background-color: #e6f9f0; transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .payment-option.stripe.active { border-color: var(--stripe-color); background-color: var(--info-color); }
        .payment-option img { height: 50px; max-width: 120px; object-fit: contain; }
        .payment-option span { font-weight: 700; color: var(--dark-color); }

        /* UPDATED: Bank Details Container Styling */
        .payment-details-container { display: none; background: #e9f5ff; padding: 25px; border-radius: var(--border-radius); margin-top: 20px; border: 1px solid #bde0fe; }
        .payment-details-container.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .payment-instructions h4 { font-size: 1.4rem; font-weight: 900; color: var(--dark-color); margin-top: 0; margin-bottom: 20px; text-align: center; }
        .instruction-card { background-color: var(--light-color); border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .instruction-card h5 { margin: 0 0 15px 0; font-size: 1.1rem; font-weight: 700; color: var(--primary-color); display: flex; align-items: center; gap: 10px; }
        .detail-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e9ecef; }
        .detail-row:last-child { border-bottom: none; }
        .detail-row .label { font-weight: 700; color: #6c757d; }
        .detail-row .value { font-weight: 700; color: var(--dark-color); direction: ltr; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        .copy-button { background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 1.1rem; }
        
        /* UPDATED: Stripe E-commerce Dotation Info Box */
        .stripe-info-box {
            display: none; background-color: var(--info-color); border-left: 6px solid var(--stripe-color);
            border-radius: var(--border-radius); padding: 25px; margin-top: 20px; animation: fadeIn 0.5s;
        }
        .stripe-info-box.active { display: block; }
        .stripe-info-box h4 {
            margin-top: 0; margin-bottom: 15px; color: var(--dark-color); font-weight: 900;
            font-size: 1.3rem; display: flex; align-items: center; gap: 12px;
        }
        .stripe-info-box h4 .fa-credit-card { color: var(--stripe-color); }
        .stripe-info-box p { margin-bottom: 5px; line-height: 1.8; font-size: 1rem; }
        .stripe-info-box strong { color: var(--primary-color); }
    </style>
</head>
<body>

    <header class="main-header">
        <nav class="navbar">
            <a href="index.html" class="navbar-logo">
                <img src="https://github.com/radwanyhassan75/logo.png/blob/main/20832c91-c5a0-4bb1-a95f-b8c8bd097d7a-removebg-preview.png?raw=true" alt="شعار المكتب الرقمي">
            </a>
            <ul class="navbar-menu">
                <li><a href="index.html">الرئيسية</a></li>
                <li><a href="services.html">الخدمات</a></li>
                <li><a href="contact.html">اتصل بنا</a></li>
            </ul>
        </nav>
    </header>

    <div class="page-container">
        <header class="page-header">
            <h1>إتمام الطلب</h1>
        </header>

        <form id="payment-form">
            <!-- Steps 1, 2, 3 remain the same -->
            <div class="card">
                <div class="card-header"><span class="step-icon">1</span><h3>ملخص الطلب</h3></div>
                <div class="form-group"><label>الخدمة المطلوبة:</label><input type="text" id="display-service-name" readonly></div>
                <div class="form-group"><label>السعر:</label><input type="text" id="display-service-price" readonly></div>
            </div>
            <input type="hidden" id="form-service-name" name="serviceName"><input type="hidden" id="form-service-price" name="price">
            <div class="card">
                <div class="card-header"><span class="step-icon">2</span><h3>معلوماتك الشخصية</h3></div>
                <div class="form-group"><label for="name">الاسم الكامل <span class="required-star">*</span></label><input type="text" name="customerName" id="name" required /></div>
                <div class="form-group"><label for="email">البريد الإلكتروني <span class="required-star">*</span></label><input type="email" name="email" id="email" required /></div>
                <div class="form-group"><label for="phone">رقم الهاتف / واتساب <span class="required-star">*</span></label><input type="tel" name="phone" id="phone" required /></div>
            </div>
            <div class="card">
                <div class="card-header"><span class="step-icon">3</span><h3>تفاصيل إضافية</h3></div>
                <div class="form-group"><label for="service-details">تفاصيل الخدمة المطلوبة <span class="required-star">*</span></label><textarea name="serviceDetails" id="service-details" required placeholder="مثلاً: أحتاج كتابة سيرة ذاتية..."></textarea></div>
                <div class="form-group"><label for="service-link">رابط (اختياري)</label><input type="url" name="serviceLink" id="service-link" /></div>
            </div>

            <!-- Step 4: Payment (Updated) -->
            <div class="card">
                <div class="card-header"><span class="step-icon">4</span><h3>الدفع وتأكيد الطلب</h3></div>
                <div class="form-group">
                    <label>اختر وسيلة الدفع <span class="required-star">*</span></label>
                    <div class="payment-options-grid" id="payment-options"></div>
                    <input type="hidden" name="paymentMethod" id="payment-method-input" required>
                </div>
                
                <div id="payment-details-container" class="payment-details-container"></div>
                
                <div id="stripe-info-box" class="stripe-info-box">
                    <h4><i class="fas fa-credit-card"></i> تنبيه هام للدفع بالبطاقة</h4>
                    <p>لضمان نجاح الدفع، يجب تفعيل <strong>"مخصصات التجارة الإلكترونية" (Dotation e-commerce)</strong> على بطاقتك البنكية.</p>
                    <p>يمكنك تفعيلها فوراً من خلال تطبيق البنك الخاص بك.</p>
                </div>

                <div class="form-group" id="receipt-upload-group">
                    <label for="receipt">أرفق وصل الدفع (صورة أو PDF) <span class="required-star">*</span></label>
                    <input type="file" name="receiptFile" id="receipt" accept=".png,.jpg,.jpeg,.pdf" required />
                </div>
                
                <button type="submit" class="submit-btn" id="submit-btn" disabled><i class="fas fa-lock"></i> أكمل الحقول المطلوبة</button>
                <div id="form-error"></div>
            </div>
        </form>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="auth.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Element references
        const form = document.getElementById('payment-form');
        const submitBtn = document.getElementById('submit-btn');
        const errorDiv = document.getElementById('form-error');
        const paymentOptionsContainer = document.getElementById('payment-options');
        const paymentMethodInput = document.getElementById('payment-method-input');
        const paymentDetailsContainer = document.getElementById('payment-details-container');
        const receiptUploadGroup = document.getElementById('receipt-upload-group');
        const receiptInput = document.getElementById('receipt');
        const nameInput = document.getElementById('name');
        const emailInput = document.getElementById('email');
        const stripeInfoBox = document.getElementById('stripe-info-box');

        // Configuration
        const stripe = Stripe('pk_live_51Rp6K4Ju30ddBm3eqv8Og0m6doq0KMWOQKuNnbwDpMVBOeeAj44HSTeGk9O3Eb96ETblaveavwk1YWVOvFpVSvo9008NBFxGeF'); 
        const API_URL = "https://orders-worker.radwanyhassan75.workers.dev";
        
        // Static payment info as provided by the user
        const staticPaymentInfo = {
            beneficiaryName: "HASSAN ER-RADOUANY",
            cashplus: { iban: "835780030017346031053226", phone: "0621638488" },
            orange: { rib: "857780000000000109572339", phone: "0621638488" },
            bmce: { rib: "96 0000162000010401 810 011" },
            attijari: { rib: "007810000457430040232577" },
            cih: { rib: "230810624745521100540088" },
            soge: { rib: "022780000760004157217174" }
        };

        const paymentMethods = [
            { id: 'stripe', name: 'البطاقة البنكية', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/ba/Stripe_Logo%2C_revised_2016.svg/2560px-Stripe_Logo%2C_revised_2016.svg.png' },
            { id: 'cashplus', name: 'Cash Plus', logo: 'https://start-up-bucket.s3.eu-west-3.amazonaws.com/wp-content/uploads/2025/04/15173235/Cash-Plus-l-Start-up.ma_-1.png' },
            { id: 'orange', name: 'Orange Money', logo: 'https://yop.l-frii.com/wp-content/uploads/2022/12/Orange-Money-recrute-pour-ce-poste-28-Decembre-2022-1024x683.png' },
            { id: 'bmce', name: 'بنك أفريقيا', logo: 'https://www.ir-bankofafrica.ma/sites/default/files/styles/actualite/public/default_images/imgpsh_fullsize_anim.png?itok=UUjnntlS' },
            { id: 'attijari', name: 'Attijariwafa', logo: 'https://upload.wikimedia.org/wikipedia/fr/thumb/1/1d/Logo_AWB.svg/1200px-Logo_AWB.svg.png' },
            { id: 'cih', name: 'CIH Bank', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Cih-bank.png/960px-Cih-bank.png' },
            { id: 'soge', name: 'الشركة العامة', logo: 'https://cdn.snrtnews.com/sites/default/files/2025/06/18/whatsapp-image-2025-06-18-at-13-1750248285.jpeg' }
        ];
        
        function renderPaymentOptions() {
            paymentOptionsContainer.innerHTML = '';
            paymentMethods.forEach(method => {
                const optionDiv = document.createElement('div');
                optionDiv.className = `payment-option ${method.id}`;
                optionDiv.dataset.method = method.id;
                optionDiv.innerHTML = `<img src="${method.logo}" alt="${method.name}"><span>${method.name}</span>`;
                optionDiv.addEventListener('click', () => selectPaymentMethod(method.id));
                paymentOptionsContainer.appendChild(optionDiv);
            });
        }

        function selectPaymentMethod(selectedMethodId) {
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.method === selectedMethodId);
            });
            const selectedMethod = paymentMethods.find(m => m.id === selectedMethodId);
            paymentMethodInput.value = selectedMethod.name;

            if (selectedMethodId === 'stripe') {
                receiptUploadGroup.style.display = 'none';
                receiptInput.required = false;
                paymentDetailsContainer.classList.remove('active');
                stripeInfoBox.classList.add('active');
            } else {
                receiptUploadGroup.style.display = 'block';
                receiptInput.required = true;
                stripeInfoBox.classList.remove('active');
                renderPaymentDetails(selectedMethodId);
            }
            validateForm();
        }

        // FIXED: Bank Details Rendering Logic
        function renderPaymentDetails(methodId) {
            const beneficiary = staticPaymentInfo.beneficiaryName;
            let detailsHtml = `<div class="payment-instructions"><h4><i class="fas fa-money-check-alt"></i> معلومات الدفع لـ: ${beneficiary}</h4>`;

            switch (methodId) {
                case 'cashplus':
                    detailsHtml += `
                        <div class="instruction-card">
                            <h5><i class="fas fa-university"></i> 1. إذا كنت ترسل من وكالة بنكية أو تطبيق بنك:</h5>
                            ${createDetailRow('IBAN', staticPaymentInfo.cashplus.iban)}
                            ${createDetailRow('الاسم الكامل', beneficiary, false)}
                        </div>
                        <div class="instruction-card">
                            <h5><i class="fas fa-mobile-alt"></i> 2. إذا كنت ترسل من وكالة أو تطبيق Cash Plus:</h5>
                            ${createDetailRow('رقم الهاتف', staticPaymentInfo.cashplus.phone)}
                            ${createDetailRow('الاسم الكامل', beneficiary, false)}
                        </div>`;
                    break;
                case 'orange':
                    detailsHtml += `
                        <div class="instruction-card">
                            <h5><i class="fas fa-university"></i> 1. إذا كنت ترسل من وكالة بنكية أو تطبيق بنك:</h5>
                            ${createDetailRow('رقم الحساب', staticPaymentInfo.orange.rib)}
                             ${createDetailRow('الاسم الكامل', beneficiary, false)}
                        </div>
                        <div class="instruction-card">
                            <h5><i class="fas fa-mobile-alt"></i> 2. إذا كنت ترسل من وكالة أو تطبيق Orange Money:</h5>
                            <p style="margin: 0 0 10px 0;">أرسل المبلغ مباشرة إلى رقم الهاتف عبر التطبيق أو الوكالات.</p>
                            ${createDetailRow('رقم الهاتف', staticPaymentInfo.orange.phone)}
                            ${createDetailRow('الاسم الكامل', beneficiary, false)}
                        </div>`;
                    break;
                case 'bmce':
                case 'attijari':
                case 'cih':
                case 'soge':
                    const bankName = paymentMethods.find(m => m.id === methodId).name;
                    detailsHtml += `
                        <div class="instruction-card">
                            <h5><i class="fas fa-landmark"></i> التحويل عبر ${bankName}</h5>
                            ${createDetailRow('رقم الحساب', staticPaymentInfo[methodId].rib)}
                            ${createDetailRow('الاسم الكامل', beneficiary, false)}
                        </div>`;
                    break;
            }

            detailsHtml += `</div>`;
            paymentDetailsContainer.innerHTML = detailsHtml;
            paymentDetailsContainer.classList.add('active');
        }

        function createDetailRow(label, value, canCopy = true) {
            const id = `val-${Math.random().toString(36).substr(2, 9)}`;
            const copyBtnHtml = canCopy ? `<button type="button" class="copy-button" onclick="copyToClipboard('${id}')"><i class="far fa-copy"></i></button>` : '';
            return `<div class="detail-row">
                        <span class="label">${label}:</span>
                        <span class="value" id="${id}">${value || 'غير متوفر'} ${copyBtnHtml}</span>
                    </div>`;
        }

        window.copyToClipboard = function(elementId) {
             const textElement = document.getElementById(elementId);
             if (!textElement) return;
             // Clone node to get text content without the button inside
             const nodeToCopy = textElement.cloneNode(true);
             const buttonToRemove = nodeToCopy.querySelector('button');
             if(buttonToRemove) nodeToCopy.removeChild(buttonToRemove);
             
             navigator.clipboard.writeText(nodeToCopy.textContent.trim()).then(() => {
                 const copyButton = textElement.querySelector('button');
                 if (copyButton) {
                     const originalIcon = copyButton.innerHTML;
                     copyButton.innerHTML = '<i class="fas fa-check" style="color: var(--success-color);"></i>';
                     setTimeout(() => { copyButton.innerHTML = originalIcon; }, 2000);
                 }
             });
        };

        function validateForm() {
            const requiredInputs = Array.from(form.querySelectorAll('[required]'));
            let isFormValid = true;
            requiredInputs.forEach(input => {
                if (!input.closest('.form-group') || input.closest('.form-group').style.display !== 'none') {
                    if (input.type === 'file') { if (!input.files.length) isFormValid = false; } 
                    else if (!input.value.trim()) { isFormValid = false; }
                }
            });
            
            submitBtn.disabled = !isFormValid;
            const selectedMethodId = document.querySelector('.payment-option.active')?.dataset.method;

            if (isFormValid) {
                if (selectedMethodId === 'stripe') {
                    submitBtn.innerHTML = '<i class="fab fa-stripe-s"></i> الدفع الآمن عبر البطاقة';
                    submitBtn.className = 'submit-btn stripe';
                } else {
                    submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> تأكيد وإرسال الطلب';
                    submitBtn.className = 'submit-btn bank-transfer';
                }
            } else {
                submitBtn.innerHTML = '<i class="fas fa-lock"></i> أكمل الحقول المطلوبة';
                submitBtn.className = 'submit-btn';
            }
        }
        
        async function handleStripePayment() {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التوجيه للدفع...';
            errorDiv.style.display = 'none';
            try {
                const orderData = {
                    serviceName: document.getElementById('form-service-name').value,
                    price: document.getElementById('form-service-price').value,
                    customerName: nameInput.value,
                    customerEmail: emailInput.value,
                    customerPhone: document.getElementById('phone').value,
                    serviceDetails: document.getElementById('service-details').value,
                    serviceLink: document.getElementById('service-link').value,
                    userId: (typeof auth !== 'undefined' && auth.currentUser) ? auth.currentUser.uid : 'guest-user'
                };
                const response = await fetch(`${API_URL}/api/create-checkout-session`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                const session = await response.json();
                if (response.ok) {
                    const result = await stripe.redirectToCheckout({ sessionId: session.id });
                    if (result.error) throw new Error(result.error.message);
                } else {
                    throw new Error(session.error || 'فشل في إنشاء جلسة الدفع.');
                }
            } catch(error) {
                console.error('Stripe Error:', error);
                errorDiv.textContent = 'حدث خطأ أثناء محاولة الدفع. \n' + error.message;
                errorDiv.style.display = 'block';
                validateForm();
            }
        }

        async function handleBankTransferPayment() {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
            errorDiv.style.display = 'none';
            const formData = new FormData(form);
            if (typeof auth !== 'undefined' && auth.currentUser) {
                formData.append('userId', auth.currentUser.uid);
            } else {
                formData.append('userId', 'guest-user');
            }
            try {
                const response = await fetch(`${API_URL}/orders`, { method: 'POST', body: formData });
                const result = await response.json();
                if (response.ok && result.success) {
                    window.location.href = result.redirectUrl;
                } else {
                    throw new Error(result.error || 'فشل الخادم في معالجة الطلب.');
                }
            } catch (error) {
                console.error('Submit Error:', error);
                errorDiv.textContent = 'فشل إرسال الطلب. \n' + error.message;
                errorDiv.style.display = 'block';
                validateForm();
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (submitBtn.disabled) return;
            const selectedMethodId = document.querySelector('.payment-option.active')?.dataset.method;
            if (selectedMethodId === 'stripe') {
                handleStripePayment();
            } else {
                handleBankTransferPayment();
            }
        });

        // Initial Page Setup
        const params = new URLSearchParams(window.location.search);
        document.getElementById('display-service-name').value = params.get('service') || "غير محدد";
        document.getElementById('display-service-price').value = (params.get('price') || "0") + " درهم";
        document.getElementById('form-service-name').value = params.get('service') || "غير محدد";
        document.getElementById('form-service-price').value = params.get('price') || "0";
        if (typeof auth !== 'undefined') {
            auth.onAuthStateChanged(user => {
                if (user) {
                    if (user.displayName) nameInput.value = user.displayName;
                    if (user.email) emailInput.value = user.email;
                    validateForm();
                }
            });
        }
        form.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', validateForm);
        });
        
        // Use static data directly instead of fetching
        renderPaymentOptions();
        validateForm();
    });
    </script>
</body>
</html>
