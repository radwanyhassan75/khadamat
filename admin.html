<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #0056b3; --dark-color: #2c3e50; --light-color: #ffffff;
            --gray-color: #f4f7f9; --border-radius: 8px; --box-shadow: 0 5px 25px rgba(0,0,0,0.08);
        }
        body { font-family: 'Cairo', sans-serif; margin: 0; direction: rtl; background-color: var(--gray-color); }
        .admin-container { max-width: 1200px; margin: 40px auto; padding: 20px; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        h1 { font-size: 2.5rem; color: var(--dark-color); margin: 0; }
        .btn { padding: 10px 20px; border: none; border-radius: var(--border-radius); font-weight: 700; cursor: pointer; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .orders-table-wrapper { background-color: var(--light-color); border-radius: var(--border-radius); box-shadow: var(--box-shadow); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; text-align: right; }
        th, td { padding: 15px 20px; border-bottom: 1px solid #eee; white-space: nowrap; }
        th { background-color: #f8f9fa; font-size: 1.1rem; }
        select { padding: 8px; border-radius: var(--border-radius); border: 1px solid #ccc; }
        #loader { text-align: center; padding: 50px; font-size: 1.5rem; }
        .fa-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-tasks"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
            <button class="btn btn-primary" id="refresh-btn"><i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«</button>
        </div>
        <div class="orders-table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                        <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                        <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</th>
                        <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="orders-tbody">
                    <tr id="loader"><td colspan="6"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzDsqnTQkC6Dn3LaKaC52QOwC8_oXfhJ2vFIeOa4zjP4nFN_E48O-06o9ALTt6BLUh8hA/exec"; // ğŸ‘ˆ Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø·Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§
            const ordersTbody = document.getElementById('orders-tbody');
            const refreshBtn = document.getElementById('refresh-btn');

            async function fetchAndDisplayOrders() {
                ordersTbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 50px;"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
                try {
                    const response = await fetch(`${SCRIPT_URL}?action=getAll`);
                    if (!response.ok) {
                        throw new Error(`Network Error: ${response.statusText}`);
                    }
                    const orders = await response.json();
                    ordersTbody.innerHTML = ''; 

                    if (orders.error) throw new Error(orders.error);

                    if (orders.length === 0) {
                        ordersTbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠÙ‹Ø§.</td></tr>';
                        return;
                    }
                    
                    orders.reverse().forEach(order => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${order.orderId}</td>
                            <td>${order.customerName}</td>
                            <td>${order.serviceName || ''}</td>
                            <td><select class="payment-status"><option value="Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹" ${order.paymentStatus === 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹' ? 'selected' : ''}>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹</option><option value="ØªÙ… Ø§Ù„Ø¯ÙØ¹" ${order.paymentStatus === 'ØªÙ… Ø§Ù„Ø¯ÙØ¹' ? 'selected' : ''}>ØªÙ… Ø§Ù„Ø¯ÙØ¹</option></select></td>
                            <td><select class="order-status"><option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ${order.orderStatus === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option><option value="ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²" ${order.orderStatus === 'ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²' ? 'selected' : ''}>ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</option></select></td>
                            <td><button class="btn btn-primary btn-save" data-order-id="${order.orderId}">Ø­ÙØ¸</button></td>
                        `;
                        ordersTbody.appendChild(tr);
                    });
                } catch (error) {
                    ordersTbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:red;">Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}</td></tr>`;
                    console.error('Error fetching orders:', error);
                }
            }

            ordersTbody.addEventListener('click', async function(e) {
                if (e.target && e.target.classList.contains('btn-save')) {
                    const saveButton = e.target;
                    // ... (The rest of the save logic) ...
                }
            });

            fetchAndDisplayOrders();
            refreshBtn.addEventListener('click', fetchAndDisplayOrders);
        });
    </script>
</body>
</html>